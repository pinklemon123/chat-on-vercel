<!doctype html><meta charset="utf-8">
<title>Chat</title>
<link rel="stylesheet" href="/styles.css">
<div id="app">
  <h1>AI Chat</h1>
  <div id="chat" style="height:60vh;overflow:auto;border:1px solid #334155;padding:10px;border-radius:12px;"></div>
  <form id="f" style="display:flex;gap:8px;margin-top:8px">
    <textarea id="q" rows="3" style="flex:1"></textarea>
    <button>发送</button>
  </form>
</div>
<script>
const chat = document.getElementById('chat');
const q = document.getElementById('q');
document.getElementById('f').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const text = q.value.trim(); if(!text) return;
  chat.innerHTML += `<div><b>你：</b>${text}</div>`; q.value='';
  const resp = await fetch('/api/chat',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({messages:[{role:'user',content:text}]})});
  const reader = resp.body.getReader(), dec=new TextDecoder(); let acc='';
  while(true){const {value,done}=await reader.read(); if(done) break; acc+=dec.decode(value); chat.innerHTML = chat.innerHTML.replace(/(<div><b>AI：<\/b>.*)?$/, '') + `<div><b>AI：</b>${acc}</div>`; chat.scrollTop=chat.scrollHeight;}
});
</script>
